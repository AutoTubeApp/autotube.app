<template>
  <div>
    <v-container v-if="toc && article">
      <SocialHead :title="'Autotube - ' + article.title" :description="article.description" />
      <v-row>
        <v-col
          id="toc"
          cols="12"
          md="3"
          lg="2"
          class="pa-1 pt-3 mr-2 pr-3 d-xs-flex d-sm-block"
        >
          <v-list-item
            v-for="t in toc"
            :key="t.slug"
            nuxt
            :to="t.path"
          >
            <v-list-item-content>
              <v-list-item-title class="text-capitalize">
                {{ t.slug }}
              </v-list-item-title>
            </v-list-item-content>
          </v-list-item>
        </v-col>
        <v-col>
          <nuxt-content :document="article" />
        </v-col>
      </v-row>
    </v-container>
  </div>
</template>

<script>

export default {
  async asyncData ({
    $content,
    params,
    redirect
  }) {
    // const server = process.env.NODE_ENV !== 'production' ? 'http://localhost:3000' : 'https://autotube.app'
    // const server = 'http://localhost:3000'
    const server = ''

    if (!params.slug) {
      try {
        await redirect(302, `${server}/docs/introduction`)
        return
      } catch (e) {
        return
        // do nothing is to avoid error
        // a0417b4.js:2 Uncaught (in promise) Error: ERR_REDIRECT
        // le probl√®me c'est qu'on demande au routeur de venir ici pour ensuite
        // faire un redirect "direct"
        // push('/route') && redirect
      }
    }
    const article = await $content('docs', params.slug).fetch()

    const toc = await $content('docs')
      .only(['slug', 'path'])
      .sortBy('index')
      .fetch()
    return { article, toc }
  },

  data () {
    return {
      toc: null,
      article: null
    }
  },
  head () {
    if (this.article === null) { return }
    return {
      title: this.article ? this.article.title : '',
      meta: [
        {
          hid: 'description',
          name: 'description',
          content: this.article.description
        }
      ]
    }
  },
  mounted () {
  }

}
</script>

<style>
#toc {
  border-right-style: solid;
  border-right-color: rgba(25, 118, 210, 0.3);
  border-right-width: 1px;
}

.nuxt-content h2 {
  padding-bottom: .5rem;
  margin-bottom: 2rem;
  margin-top: 1.5rem;
  border-bottom-width: 1px;
  border-bottom-color: rgba(25, 118, 210, 0.3);
  border-bottom-style: solid;
}

.nuxt-content pre {
  background-color: #fdf6ef;
}

.nuxt-content img {
  margin-bottom: 1rem;
  max-width: 800px;
}

.nuxt-content blockquote
{
  font-style: normal;
  margin-left: 22px;
  border-left: 4px solid #e5671e;
  padding-left: 8px;
}

</style>
